---
export interface Props {
	title: string;
	description?: string;
	image?: string;
	type?: string;
	canonical?: string;
}

const { 
	title, 
	description = "Mapping the emotional landscape of our times through stories of progress and setback",
	image = "/og-image.png",
	type = "website",
	canonical
} = Astro.props;

const canonicalURL = canonical || new URL(Astro.url.pathname, Astro.site);
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
		<!-- SEO Meta Tags -->
		<title>{title}</title>
		<link rel="canonical" href={canonicalURL} />
		<meta name="robots" content="index, follow" />
		<meta name="author" content="Hope and Despair" />
		
		<!-- Open Graph -->
		<meta property="og:type" content={type} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={new URL(image, Astro.site)} />
		<meta property="og:url" content={canonicalURL} />
		<meta property="og:site_name" content="Hope and Despair" />
		
		<!-- Twitter Cards -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		<meta name="twitter:image" content={new URL(image, Astro.site)} />
		
		<!-- Favicons -->
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
		
		<!-- RSS Feed -->
		<link rel="alternate" type="application/rss+xml" title="Hope and Despair RSS Feed" href="/rss.xml" />
		
		<!-- Optimized fonts for screen readability -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,500;0,8..60,600;1,8..60,400&display=swap" rel="stylesheet">
		<script>
			// Prevent flash of incorrect theme
			(function() {
				const savedTheme = localStorage.getItem('theme') || 'light';
				document.documentElement.setAttribute('data-theme', savedTheme);
			})();
		</script>
		
		<!-- Schema.org structured data -->
		<script type="application/ld+json">
		{
			"@context": "https://schema.org",
			"@type": "WebSite",
			"name": "Hope and Despair",
			"description": description,
			"url": Astro.site?.toString()
		}
		</script>
	</head>
	<body>
		<slot />
		<button id="theme-toggle" aria-label="Toggle theme" class="theme-toggle">
			<span class="theme-icon">ðŸŒ“</span>
		</button>
		
		<script>
			const themeToggle = document.getElementById('theme-toggle');
			
			themeToggle?.addEventListener('click', () => {
				const currentTheme = document.documentElement.getAttribute('data-theme');
				const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
				document.documentElement.setAttribute('data-theme', newTheme);
				localStorage.setItem('theme', newTheme);
			});
		</script>
	</body>
</html>

<style is:global>
	:root {
		--bg-primary: #ffffff;
		--bg-secondary: #fafafa;
		--bg-card: #ffffff;
		--text-primary: #111111;
		--text-secondary: #444444;
		--text-muted: #777777;
		--border-color: #e8e8e8;
		--accent-color: #9cae9c;
		--hover-bg: #f5f5f5;
		--shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
		--nav-bg: rgba(255, 255, 255, 0.95);
		--nav-border: rgba(0, 0, 0, 0.06);
	}

	[data-theme="dark"] {
		--bg-primary: #0f0f0f;
		--bg-secondary: #1a1a1a;
		--bg-card: #1e1e1e;
		--text-primary: #f0f0f0;
		--text-secondary: #b3b3b3;
		--text-muted: #888;
		--border-color: #333;
		--accent-color: #7a9a6e;
		--hover-bg: #2a2a2a;
		--shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
		--nav-bg: rgba(15, 15, 15, 0.95);
		--nav-border: rgba(255, 255, 255, 0.06);
	}

	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
	}

	body {
		font-family: 'Source Serif 4', 'Source Serif Pro', Georgia, serif;
		background: var(--bg-primary);
		color: var(--text-primary);
		line-height: 1.7;
		font-weight: 400;
		font-size: 18px; /* Slightly larger base for better readability */
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
		transition: background-color 0.3s ease, color 0.3s ease;
		text-rendering: optimizeLegibility;
		font-optical-sizing: auto;
	}

	.container {
		max-width: 1100px;
		margin: 0 auto;
		padding: 0 40px;
	}

	/* Typography scale - Editorial feel with serif headings */
	h1, h2, h3 {
		font-family: 'Source Serif 4', 'Source Serif Pro', Georgia, serif;
		font-weight: 500;
		line-height: 1.2;
		margin-bottom: 0.75em;
		color: var(--text-primary);
		letter-spacing: -0.01em;
	}

	h4, h5, h6 {
		font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
		font-weight: 600;
		line-height: 1.3;
		margin-bottom: 0.75em;
		color: var(--text-primary);
		letter-spacing: -0.02em;
	}

	/* Consistent type scale using 1.25 ratio */
	h1 { font-size: 2.8rem; }
	h2 { font-size: 2.25rem; }
	h3 { font-size: 1.8rem; }
	h4 { font-size: 1.44rem; }
	h5 { font-size: 1.15rem; }
	h6 { font-size: 0.92rem; }

	p {
		margin-bottom: 1.25em;
		max-width: 70ch;
		color: var(--text-secondary);
	}

	/* Better link styling */
	a {
		color: inherit;
		text-decoration: underline;
		text-decoration-color: rgba(0, 0, 0, 0.2);
		text-underline-offset: 2px;
		transition: all 0.2s ease;
	}

	a:hover {
		text-decoration-color: currentColor;
	}

	/* Reading optimizations */
	.reading-content {
		font-size: 1.125rem;
		line-height: 1.7;
		max-width: 65ch;
		margin: 0 auto;
	}

	.nav-bar {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		background: var(--nav-bg);
		backdrop-filter: blur(20px);
		border-bottom: 1px solid var(--nav-border);
		z-index: 100;
		padding: 20px 0;
		opacity: 1;
		transform: translateY(0);
	}

	.nav-content {
		max-width: 1100px;
		margin: 0 auto;
		padding: 0 40px;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.nav-logo {
		font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
		font-size: 1.5rem;
		font-weight: 700;
		color: var(--text-primary);
		text-decoration: none;
		letter-spacing: -0.02em;
	}

	.nav-links {
		display: flex;
		gap: 32px;
	}

	.nav-link {
		font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
		font-size: 0.9rem;
		color: var(--text-secondary);
		text-decoration: none;
		font-weight: 500;
		transition: color 0.2s ease;
	}

	.nav-link:hover, .nav-link.active {
		color: var(--text-primary);
	}

	/* Theme toggle button */
	.theme-toggle {
		position: fixed;
		bottom: 30px;
		right: 30px;
		width: 50px;
		height: 50px;
		border-radius: 50%;
		background: var(--bg-card);
		border: 2px solid var(--border-color);
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		box-shadow: var(--shadow);
		transition: all 0.3s ease;
		z-index: 1000;
	}

	.theme-toggle:hover {
		transform: scale(1.1);
		box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
	}

	.theme-icon {
		font-size: 1.5rem;
	}

	/* Enhanced responsive design */
	@media (max-width: 768px) {
		.container, .nav-content {
			padding: 0 24px;
		}
		
		.nav-links {
			gap: 20px;
			font-size: 0.85rem;
		}
		
		.nav-logo {
			font-size: 1.3rem;
		}

		body {
			font-size: 16px;
			line-height: 1.7;
		}
		
		/* Scale down headings for mobile */
		h1 { font-size: 2.2rem; }
		h2 { font-size: 1.8rem; }
		h3 { font-size: 1.5rem; }

		p {
			max-width: 100%;
		}
	}

	@media (max-width: 480px) {
		.container, .nav-content {
			padding: 0 16px;
		}
		
		.nav-bar {
			padding: 15px 0;
		}
		
		.nav-links {
			gap: 15px;
			font-size: 0.8rem;
		}
		
		.nav-logo {
			font-size: 1.2rem;
		}
		
		.theme-toggle {
			bottom: 20px;
			right: 20px;
			width: 45px;
			height: 45px;
		}
	}
</style>